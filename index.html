<!DOCTYPE html>

<html>

<head>
<title>Mapa Ruta del Café</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta property="og:title" content="Mapa Ruta del Café Jaén San Ignacio " />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="yilaa" />
<meta property="og:url" content="https://yilaa.github.io/rutacafejaen" />
<meta property="og:description" content="Primera versión de un mapa interactivo" />
<meta name="og:image" content="https://yilaa.github.io/rutacafejaen/img/mapafb" />
<link href="https://fonts.googleapis.com/css?family=Bree+Serif&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
<link rel="stylesheet" href="style.css" />


<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://kit.fontawesome.com/9c7499abbb.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="css/leaflet.extra-markers.min.css">
<script src="js/leaflet.extra-markers.min.js"></script>
<script type="text/javascript" src="js/map-rdc.js"></script>
<script type="text/javascript" src="js/provincias.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

</head>

<body>
  <div id="overlay">
    <div class='header'>
    <h2>Ruta del Café Jaén - San Ignacio</h2>
    <p>Viaja a Jaén y San Ignacio, para descubrir cómo se produce un café de excelente calidad,
      y disfrutar de las cataratas y bosques que rodean los cafetales.</p>
  </div>
    <select name="select-location" id="select-location">
      <option value="0">Selecciona uno</option>
    </select>
  </div>
  <div id=slide-in>
    <button class='slide-in__boton'>cerrar</button>
    <h2 id="tituloAtractivo"></h2>
    <p id="infoAtractivo"></p>
    <p id="actividadesAtractivo"></p>
    <section class="carousel" aria-label="Gallery">
      <ol class="carousel__viewport">
        <li id="carousel__slide1"
            tabindex="0"
            class="carousel__slide">
          <div class="carousel__snapper">
            <a href="#carousel__slide4"
               class="carousel__prev">Go to last slide</a>
            <a href="#carousel__slide2"
               class="carousel__next">Go to next slide</a>
          </div>
        </li>
        <li id="carousel__slide2"
            tabindex="0"
            class="carousel__slide">
          <div class="carousel__snapper"></div>
          <a href="#carousel__slide1"
             class="carousel__prev">Go to previous slide</a>
          <a href="#carousel__slide3"
             class="carousel__next">Go to next slide</a>
        </li>
        <li id="carousel__slide3"
            tabindex="0"
            class="carousel__slide">
          <div class="carousel__snapper"></div>
          <a href="#carousel__slide2"
             class="carousel__prev">Go to previous slide</a>
          <a href="#carousel__slide4"
             class="carousel__next">Go to next slide</a>
        </li>
      </ol>
      <aside class="carousel__navigation">
        <ol class="carousel__navigation-list">
          <li class="carousel__navigation-item">
            <a href="#carousel__slide1"
               class="carousel__navigation-button">Go to slide 1</a>
          </li>
          <li class="carousel__navigation-item">
            <a href="#carousel__slide2"
               class="carousel__navigation-button">Go to slide 2</a>
          </li>
          <li class="carousel__navigation-item">
            <a href="#carousel__slide3"
               class="carousel__navigation-button">Go to slide 3</a>
          </li>
        </ol>
      </aside>
    </section>
  </div>
  </div>
<div id='map'>
</div>

<script>
var map = L.map('map', {
    //center: new L.LatLng(-5.443126, -78.833394),
    //zoom: 10,
    zoomControl: false
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		}).addTo(map);

// Zoom controls
L.control.zoom({
     position:'topright'
}).addTo(map);


//geojson provincias

var estiloProvincia = {
  'color': 'rgba(122,184,0)',
  'weight': 2
  //'opacity': 1
}
var provinciasRDC = L.geoJson(provincias, {
 style: estiloProvincia,
//  onEachFeature: function (feature,layer) {
//         layer.bindPopup('<strong>Provincia</strong>: ' + feature.properties.PROVINCIA + '<br/><strong>Departamento</strong>: '+ feature.properties.DEPARTAMEN);
// }
}).addTo(map);


// Marcadores ruta cafe
var cafe = L.ExtraMarkers.icon({
    icon: 'fa-coffee',
    markerColor: 'white',
    iconColor: 'rgba(122,184,0)',
    shape: 'square',
    prefix: 'fa',
    popupAnchor: [0,69]
  });
var agua = L.ExtraMarkers.icon({
    icon: 'fa-water',
    markerColor: 'white',
    iconColor: '#477AC2',
    shape: 'square',
    prefix: 'fa',
    popupAnchor: [0,69]
  });

var punto = {
    radius: 4,
    fillColor: "#ff7800",
    color: "#76381a",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8,
    popupAnchor: [0,69]
};

var MapaRutaCafe = L.geoJson(mapardc, {
  style: function(feature) {
        switch (feature.properties.descripcion) {
          case 'ruta': return {color: "#76381a"}; break
        }
    },
  pointToLayer: function (feature, latlng) {
    switch(feature.properties.descripcion) {
        case 'finca': return L.marker(latlng, {icon: cafe})
        break
        case 'catarata': return L.marker(latlng, {icon: agua})
        break
        case 'laguna': return L.marker(latlng, {icon: agua})
        break
        case 'lugar':  return L.circleMarker(latlng, punto)
        break         
         }
    },
    onEachFeature: function (feature,layer) {
      layer.bindPopup(feature.properties.name)
      layer.on('click', function(){
        $('#slide-in').addClass('in');
        $('#tituloAtractivo').html(layer.feature.properties.name);
        $('#infoAtractivo').html(layer.feature.properties.resumen);
        $('#actividadesAtractivo').html(layer.feature.properties.actividades + ' <a href='+'>Más info (pronto el link)</a');
        $('#carousel__slide1').html('<img src='+layer.feature.properties.image+'>');
        $('#carousel__slide2').html('<img src='+layer.feature.properties.image1+'>');
        $('#carousel__slide3').html('<img src='+layer.feature.properties.image2+'>');
        var lat= feature.geometry.coordinates[1] - 0.01
        var long= feature.geometry.coordinates[0]
        map.flyTo([lat,long],14,{
              duration: 0.15
            });
        $('#select-location').val(layer.feature.properties.name);
      })
    }         
}).addTo(map)

//Bounds
map.fitBounds(provinciasRDC.getBounds());

// slide-in ocultar
$(document).on('click','.slide-in__boton',function() {
			if($('#slide-in').hasClass('in')) {
        $('#slide-in').removeClass('in');
        map.fitBounds(provinciasRDC.getBounds(), {
        padding: [2,2]
        });
      };
      $('#select-location').val(0);
    });

// selector de atractivos
mapardc.features.forEach(function(feature) {
    if (feature.properties.descripcion === 'catarata' || feature.properties.descripcion === 'finca' || feature.properties.descripcion ==='laguna' ){
        $('#select-location').append('<option value="'+feature.properties.name+'">'+feature.properties.name+'</option>');
        }	
});

$(document).on('change','#select-location',function(e) {
			var atractivo = e.target.value;
			if(atractivo!==0) {
				MapaRutaCafe.eachLayer(function(layer) {
         if(layer.feature.properties.name===e.target.value){
            layer.bindPopup(layer.feature.properties.name).openPopup() 
            $('#slide-in').addClass('in');
            $('#tituloAtractivo').html(layer.feature.properties.name);
            $('#infoAtractivo').html(layer.feature.properties.resumen);
            $('#actividadesAtractivo').html(layer.feature.properties.actividades + ' <a href='+'>Más info (pronto el link)</a');
            $('#carousel__slide1').html('<img src='+layer.feature.properties.image+'>');
            $('#carousel__slide2').html('<img src='+layer.feature.properties.image1+'>');
            $('#carousel__slide3').html('<img src='+layer.feature.properties.image2+'>');
            var lat= layer.feature.geometry.coordinates[1] - 0.01
            var long= layer.feature.geometry.coordinates[0]
            map.flyTo([lat,long],14,{
              duration: 0.20
            });
            
          }
        
        });
      }
    });
    

</script>


</body>

</html>
